<div class="help-chat-container">
    <div class="chat-header">
        <div class="chat-avatar">
            <mat-icon style="font-size:2.2rem;">support_agent</mat-icon>
        </div>
        <div class="chat-title">
            <ng-container *ngIf="headerOperatorName; else searchingHeader">
                {{ headerOperatorName }}
                <div class="chat-operator-label">{{ 'HELP_CHAT_OPERATOR' | translate }}</div>
            </ng-container>
            <ng-template #searchingHeader>
                {{ 'HELP_CHAT_SEARCHING' | translate }}
            </ng-template>
        </div>
    </div>

    <div class="ready-questions">
        <span>{{ 'HELP_CHAT_READY_QUESTIONS' | translate }}</span>
        <button *ngFor="let q of readyQuestions" (click)="askReadyQuestion(q.q)">
            {{ q.q }}
        </button>
    </div>

    <div class="chat-box">
        <ng-container *ngFor="let msg of chat; let i = index">
            <div [ngClass]="msg.from">
                <div class="msg-bubble">
                    {{ msg.text }}
                    <div class="msg-time">{{ getTime(i) }}</div>
                </div>
            </div>
        </ng-container>


        <div *ngIf="loading" class="chat-loading-row">
            <span class="chat-spinner"></span>
            <span class="chat-loading-text">{{ 'HELP_CHAT_SEARCHING_ANSWER' | translate }}</span>
        </div>

        <div *ngIf="!loading && operatorName" class="chat-operator-row">
            <mat-icon style="vertical-align: middle; color: #1976d2;">person</mat-icon>
            <span class="chat-operator-name">{{ operatorName }} {{ 'HELP_CHAT_RESPONDING' | translate }}</span>
        </div>
    </div>

    <form (ngSubmit)="sendUserMessage()" class="input-row">
        <input type="text" [(ngModel)]="userInput" name="userInput" [placeholder]="'HELP_CHAT_ENTER_QUESTION' | translate" autocomplete="off" />
        <button type="submit">{{ 'HELP_CHAT_SEND' | translate }}</button>
    </form>
    <button class="close-chat-btn" (click)="openFeedbackModal()">{{ 'HELP_CHAT_CLOSE' | translate }}</button>


    <div class="feedback-modal-overlay" *ngIf="feedbackModalOpen">
        <div class="feedback-modal">
            <div class="feedback-title">{{ 'HELP_CHAT_FEEDBACK_TITLE' | translate }}</div>
            <div class="feedback-rating-row">
                <button type="button" [class.selected]="feedbackRating === 1" (click)="setFeedbackRating(1)">
                    <span class="emoji">üò†</span> {{ 'HELP_CHAT_FEEDBACK_VERY_BAD' | translate }}
                </button>
                <button type="button" [class.selected]="feedbackRating === 2" (click)="setFeedbackRating(2)">
                    <span class="emoji">üôÅ</span> {{ 'HELP_CHAT_FEEDBACK_BAD' | translate }}
                </button>
                <button type="button" [class.selected]="feedbackRating === 3" (click)="setFeedbackRating(3)">
                    <span class="emoji">üòê</span> {{ 'HELP_CHAT_FEEDBACK_AVERAGE' | translate }}
                </button>
                <button type="button" [class.selected]="feedbackRating === 4" (click)="setFeedbackRating(4)">
                    <span class="emoji">üôÇ</span> {{ 'HELP_CHAT_FEEDBACK_GOOD' | translate }}
                </button>
                <button type="button" [class.selected]="feedbackRating === 5" (click)="setFeedbackRating(5)">
                    <span class="emoji">ü§©</span> {{ 'HELP_CHAT_FEEDBACK_LOVED' | translate }}
                </button>
            </div>

            <textarea [(ngModel)]="feedbackComment" [placeholder]="'HELP_CHAT_FEEDBACK_PLACEHOLDER' | translate" rows="3"></textarea>
            <div class="feedback-actions">
                <button type="button" class="send-btn" (click)="sendFeedback()"
                    [disabled]="!feedbackRating || feedbackSent">{{ 'HELP_CHAT_FEEDBACK_SEND' | translate }}</button>
                <button type="button" class="home-btn" (click)="goToHome()">{{ 'HELP_CHAT_FEEDBACK_BACK_HOME' | translate }}</button>
            </div>
            <div class="feedback-thankyou" *ngIf="feedbackSent">{{ 'HELP_CHAT_FEEDBACK_THANK_YOU' | translate }}</div>
            <button class="feedback-close" (click)="closeFeedbackModal()">√ó</button>
        </div>
    </div>
</div>