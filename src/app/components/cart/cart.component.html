<div class="checkout-animation-overlay" *ngIf="showCheckoutAnimation">
    <div class="checkout-animation-container" (click)="$event.stopPropagation()">
        <div class="checkout-line"></div>
        <div class="checkout-photo">
            <img src="https://png.pngtree.com/png-vector/20250607/ourmid/pngtree-realistic-3d-shopping-cart-with-product-boxes-for-e-commerce-and-png-image_16486581.png"
                alt="Checkout Animation" />
        </div>
        <div class="checkout-text">
            <mat-icon>shopping_bag</mat-icon>
            <span>Order Placed!</span>
            <div class="subtitle">Your order has been successfully submitted</div>
        </div>
        <div class="checkout-confetti">
            <div class="confetti-piece" *ngFor="let piece of confettiPieces" [style.--color]="piece.color"
                [style.--left]="piece.left + '%'" [style.--delay]="piece.animationDelay + 's'">
            </div>
        </div>
    </div>
</div>


<div class="remove-animation-overlay" *ngIf="showRemoveAnimation" (click)="closeRemoveAnimation()">
    <div class="remove-animation-container" (click)="$event.stopPropagation()">
        <div class="remove-line"></div>
        <div class="remove-photo">
            <img src="https://cdn-icons-png.flaticon.com/512/6861/6861362.png" alt="Remove Animation" />
        </div>
        <div class="remove-text">
            <mat-icon>delete_forever</mat-icon>
            <span>Item Removed!</span>
            <div class="subtitle">Product has been removed from cart</div>
        </div>
    </div>
</div>

<div class="reset-animation-overlay" *ngIf="showResetAnimation" (click)="closeResetAnimation()">
    <div class="reset-animation-container" (click)="$event.stopPropagation()">
        <div class="reset-line"></div>
        <div class="reset-photo">
            <img src="https://cdn-icons-png.flaticon.com/512/6861/6861362.png" alt="Reset Animation" />
        </div>
        <div class="reset-text">
            <mat-icon>clear_all</mat-icon>
            <span>Cart Cleared!</span>
            <div class="subtitle">All items have been removed</div>
        </div>
    </div>
</div>

<div *ngIf="cartItems && cartItems.length > 0">
    <div class="cart-container">
        <h2>Cart</h2>
        <ul>
            <li *ngFor="let item of cartItems" class="cart-item">

                <img [src]="item.product?.images?.[0] || 'https://via.placeholder.com/60x60?text=No+Image'"
                    [alt]="item.product?.title || 'პროდუქტის სურათი არ არის'"
                    style="font-size: 10px;  text-align: center;" class="cart-img" />

                <div>
                    <div class="cart-model">
                        <span class="cart-model-label">მოდელი:</span>
                        <span class="cart-model-value">{{ item.product?.title }}</span>
                    </div>
                    <div class="cart-qty-control">
                        <button class="qty-btn" (click)="updateCartQuantity(item, item.quantity - 1)"
                            [disabled]="item.quantity <= 1">-</button>
                        <span class="qty-value">{{ item.quantity }}</span>
                        <button class="qty-btn" (click)="updateCartQuantity(item, item.quantity + 1)">+</button>
                    </div>
                    <div class="cart-qty">
                        ერთეულის ფასი: {{ item.product?.price?.current || item.product?.price }} ₾
                    </div>
                    <div class="cart-total">
                        ჯამური ფასი: {{ (item.quantity * (item.product?.price?.current || item.product?.price)) |
                        number:'1.0-0' }} ₾
                    </div>
                </div>
                <button (click)="removeFromCart(item.product)">Remove</button>
            </li>
        </ul>

        <div class="cart-summary">
            <span>სრული ჯამური ფასი:</span>
            <span class="cart-summary-total">{{ cartTotal | number:'1.0-0' }} ₾</span>
        </div>

        <button class="reset-cart-btn" (click)="resetCart()">Reset Cart</button>
        <button class="checkout-btn" (click)="openPaymentModal()" [disabled]="!cartItems.length">Check Out</button>

        <button class="print-receipt-btn" (click)="printReceipt()" [disabled]="!cartItems.length">Print Receipt</button>
    </div>
</div>
<div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>იტვირთება...</p>
</div>

<div *ngIf="!loading && cartItems && cartItems.length === 0" class="cart-empty-block">
    <img src="https://cdn-icons-png.flaticon.com/512/11329/11329060.png" alt="Empty cart" class="cart-empty-img" />
    <div class="cart-empty-text">Your cart is <span class="cart-empty-red">Empty</span></div>
</div>